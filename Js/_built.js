function CaseEffectController(client){this.client=client}function ClientController(view,DOMView,helper,rtc){this.socket={},this.view=view,this.DOMView=DOMView,this.Helper=helper,this.Rtc=rtc}function CoordsProvider(){}function DOMView(helper){this.caseWidth=175,this.caseHeight=175,this.Helper=helper}function ErrorView(helper){this.Helper=helper,this.divError=$("#error-view")}function HelperController(){}function MainView(helper,DOMView,CoordsProvider){this.caseWidth=175,this.caseHeight=175,this.Helper=helper,this.CaseEffect=null,this.DOMView=DOMView,this.CoordsProvider=CoordsProvider}function manageTurn(u,users,helper,cProvider){var coords=[];if(""!==u.action1)if("Déplacer"===u.action1)coords=cProvider.getCoordsDeplacerRegarder(u),appendSelect(coords,u.action1,helper);else if("Pousser"===u.action1){for(var a in users)users.hasOwnProperty(a)&&users[a].id!==u.id&&users[a].position.x===u.position.x&&users[a].position.y===u.position.y&&coords.push(users[a]);appendCharacterSelectMe(coords,u.action1,helper)}else"Regarder"===u.action1?(coords=cProvider.getCoordsDeplacerRegarder(u),appendSelect(coords,u.action1,helper)):"Contrôller"===u.action1&&(coords=cProvider.getCoordsController(u),appendSelect(coords,u.action1,helper));else if("Déplacer"===u.action2)coords=cProvider.getCoordsDeplacerRegarder(u),appendSelect(coords,u.action2,helper);else if("Pousser"===u.action2){for(var b in users)users.hasOwnProperty(b)&&users[b].id!==u.id&&users[b].position.x===u.position.x&&users[b].position.y===u.position.y&&coords.push(users[b]);appendCharacterSelectMe(coords,u.action2,helper)}else"Regarder"===u.action2?(coords=cProvider.getCoordsDeplacerRegarder(u),appendSelect(coords,u.action2,helper)):"Contrôller"===u.action2&&(coords=cProvider.getCoordsController(u),appendSelect(coords,u.action2,helper))}function manageComplexAction(object,helper,cProvider){"Pousser"===object.action?(coords=cProvider.getCoordsDeplacerRegarder(object.user),appendSelect(coords,object.action,helper)):"Contrôller"===object.action&&$(".tourDe").append($(".selectMe").length>8?'<p class="sensArrows" data-position='+object.coords+'><span class="right direction">&rarr;</span><span class="left direction">&larr;</span><span class="top direction">&uarr;</span><span class="bottom direction">&darr;</span></p>':object.coords.split("-")[0].parseInt()>object.user.position.x||object.coords.split("-")[0].parseInt()<object.user.position.x?'<p class="sensArrows" data-position='+object.coords+'><span class="right direction">&rarr;</span><span class="left direction">&larr;</span></p>':'<p class="sensArrows" data-position='+object.coords+'><span class="top direction">&uarr;</span><span class="bottom direction">&darr;</span></p>')}function appendSelect(coords,action,helper){for(var c in coords)coords.hasOwnProperty(c)&&(helper.GetTuile(coords[c].x,coords[c].y).append('<div class="selectMe" data-action="'+action+'"></div>'),$(".selectMe").animate({width:"175px",height:"175px"},500))}function appendCharacterSelectMe(coords,action,helper){for(var c in coords)coords.hasOwnProperty(c)&&helper.GetCharacterDiv(coords[c].id).append('<div class="characterSelectMe" data-action="'+action+'"></div>')}function RTCController(udp){this.constraints={video:!0,audio:!0},this.localVideo=null,this.videos=[],this.cpt=0,this.udp=udp,this.callBtn=null,this.hangupBtn=null}function RtcPeerConnection(){this.RtcPeer=null,this.PeerConnection=null,this.IceCandidate=null,this.configurations={iceServers:[{url:"stun:23.21.150.121"},{url:"stun:stun.l.google.com:19302"},{url:"turn:numb.viagenie.ca",credential:"webrtcdemo",username:"louis%40mozilla.com"}]},this.rtcOptions={optional:[{DtlsSrtpKeyAgreement:!0}]},this.SDPConstraints={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}},this.typeRequest=null,this.ROOM=null}CaseEffectController.prototype.manageCaseEffect=function(user,effect,userMain){var nextOne=userMain?userMain:user;if("death"===effect)this.client.emitDeath(user),setTimeout(this.client.emitNextPlayer,200,nextOne);else if("noSee"===effect){var userDiv=this.client.view.Helper.GetCharacterDiv(user.id);userDiv.attr("handicap","noSee"),this.client.emitNextPlayer(nextOne)}else if("noSecondAction"===effect){var userDiv1=this.client.view.Helper.GetCharacterDiv(user.id);userDiv1.attr("handicap","noSecondAction"),this.client.emitNextPlayer(nextOne)}else if("deathAfterNextAction"===effect){var userDiv2=this.client.view.Helper.GetCharacterDiv(user.id);userDiv2.attr("handicap","deathAfterNextAction"),this.client.emitNextPlayer(nextOne)}else if("deathAfterNextTour"===effect){var userDiv3=this.client.view.Helper.GetCharacterDiv(user.id);userDiv3.attr("handicap","deathAfterNextTour"),this.client.emitNextPlayer(nextOne)}else"exchangeTuile"===effect?this.client.view.exchangeAndApplyTuile(user.id):"deathIfTwo"===effect?this.client.emitDeathForFirstHere(user):"doController"===effect?this.client.view.controller(user):"goTo2-2"===effect?this.client.emitGoToCentral(user):"doSee"===effect?(this.client.view.regarder(user.id),this.client.emitNextPlayer(nextOne)):"goInAnotherTuile"===effect?this.client.view.exchangeTuile(user):this.client.emitNextPlayer(nextOne)},ClientController.prototype.initialize=function(){this.socket=io.connect("http://roomsocket.thibaultdulon.com/"),that=this,this.socket.on("connectedUser",function(object){that.view.appendUserID(object.me),that.view.refreshUsers(object.users),that.view.manageMultipleGames(object.available,object.users)}),this.socket.on("disconnectedUser",function(user){that.view.deleteUser(user)}),this.socket.on("newCharacter",function(object){that.view.deleteCharacter(object.id,object.name,object.pseudo,object.color)}),this.socket.on("cantPlay",function(){that.DOMView.hideButton()}),this.socket.on("letsPlay",function(){that.DOMView.showButton()}),this.socket.on("everyoneIsOk",function(users){that.DOMView.hideActions();var u={};for(var a in users)if(users.hasOwnProperty(a)&&1==users[a].order){u=users[a];break}that.view.appendTurnOf(u,users,1),0===$(".selectMe").length&&0===$(".characterSelectMe").length&&u.id==that.Helper.GetCurrentID()&&that.socket.emit("noPossibilities",{user:u})}),this.socket.on("play",function(object){LastCoords=object.lastCardsCoords,OtherCoords=object.otherCoords,that.view.redirectToGame(object,that.Rtc)}),this.socket.on("canConnect",function(){that.view.allowGame()}),this.socket.on("doNextSentence",function(object){that.view.nextSentence({user:object.user,action:object.action,idTarget:object.idTarget})}),this.socket.on("doNextSentenceController",function(object){that.view.nextSentence({user:object.user,action:object.action,coords:object.coords})}),this.socket.on("playerDeplacer",function(object){that.view.deplacer(object.user)}),this.socket.on("playerPousser",function(object){that.view.pousser(object.userTarget,object.user)}),this.socket.on("playerRegarder",function(object){that.view.regarder(object.user.id,object.coords),that.Helper.GetCurrentID()==object.user.id&&that.socket.emit("nextPlayerOk",object.user)}),this.socket.on("playerController",function(object){that.view.controller(object.users,object.coords,object.sens),that.Helper.GetCurrentID()==object.user.id&&that.socket.emit("nextPlayerOk",object.user)}),this.socket.on("nextPlayer",function(object){that.DOMView.hideActions(),that.view.appendTurnOf(object.user,object.users,1),0===$(".selectMe").length&&0===$(".characterSelectMe").length&&object.user.id==that.Helper.GetCurrentID()&&that.socket.emit("noPossibilities",object)}),this.socket.on("nextPlayer2",function(object){that.DOMView.hideActions(),that.view.appendTurnOf(object.user,object.users,2),0===$(".selectMe").length&&0===$(".characterSelectMe").length&&object.user.id==that.Helper.GetCurrentID()&&that.socket.emit("noPossibilities",object)}),this.socket.on("nextTurn",function(object){that.view.nextTurn(object)}),this.socket.on("gardienWins",function(){that.DOMView.appendGardienWins()}),this.socket.on("userCentral",function(user){that.view.deplacer(user),that.Helper.GetCurrentID()==user.id&&that.socket.emit("nextPlayerOk",object.user)}),this.socket.on("exchangeTuile",function(object){that.view.exchangeTuileAndUsers(object.users,object.user,object.lastCoords),that.Helper.GetCurrentID()==object.user.id&&that.socket.emit("nextPlayerOk",object.user)}),this.socket.on("exchangeAndApplyTuile",function(object){that.view.exchangeAndApplyTuileAndUsers(object.users,object.user,object.lastCoords,object.newCoords),that.Helper.GetCurrentID()==object.user.id&&that.socket.emit("nextPlayerOk",object.user)}),this.socket.on("tokenPut",function(object){that.view.appendTokenPut(object)})},ClientController.prototype.newUser=function(name){this.socket.emit("readyToPlay",{name:name})},ClientController.prototype.validateAction=function(id,action1,action2){this.socket.emit("playerReady",{id:id,action1:action1,action2:action2})},ClientController.prototype.characterChoosen=function(name,id,color){this.socket.emit("characterChoosen",{name:name,id:id,color:color})},ClientController.prototype.play=function(){this.socket.emit("emitPlay")},ClientController.prototype.emitAction=function(element){var action=element.attr("data-action"),that=this;if("Déplacer"===action||"Regarder"===action)this.socket.emit("doAction",{id:that.Helper.GetCurrentID(),action:action,coords:element.parent().attr("data-position")}),$(".selectMe").remove();else if("Contrôller"===action)this.socket.emit("getUserAndDoNextSentenceController",{id:that.Helper.GetCurrentID(),action:action,coords:element.parent().attr("data-position")});else if("Pousser"===action&&element.parent().hasClass("character")){var idTarget=element.parent().removeClass("character").attr("class").split("-")[1];element.parent().addClass("character"),this.socket.emit("getUserAndDoNextSentence",{id:that.Helper.GetCurrentID(),action:action,idTarget:idTarget})}else"regarderMaster"===action?(this.view.regarder(that.Helper.GetCurrentID(),element.parent().attr("data-position")),$(".selectMe").remove()):"controllerMaster"===action?(this.DOMView.appendTmpMessage("Choisissez le sens dans lequel contrôller la rangée."),this.socket.emit("getUserAndDoNextSentenceController",{id:that.Helper.GetCurrentID(),action:"Contrôller",coords:element.parent().attr("data-position")})):"teleporter"===action?(this.socket.emit("exchangeTuile",{id:this.Helper.GetCurrentID(),coords:element.parent().attr("data-position")}),$(".selectMe").remove()):"exchange"===action?(this.socket.emit("exchangeAndApplyTuile",{id:this.Helper.GetCurrentID(),coords:element.parent().attr("data-position")}),$(".selectMe").remove()):(this.socket.emit("doAction",{id:that.Helper.GetCurrentID(),action:action,coords:element.parent().attr("data-position"),idTarget:$(".characterSelectMe").parent().removeClass("character").attr("class").split("-")[1]}),$(".characterSelectMe").parent().addClass("character"),$(".selectMe").remove(),$(".characterSelectMe").remove())},ClientController.prototype.emitComplexAction=function(object){var that=this;this.socket.emit("doAction",{id:that.Helper.GetCurrentID(),action:object.action,sens:object.sens,coords:object.position}),$(".selectMe").remove(),$(".sensArrows").remove()},ClientController.prototype.emitDeath=function(user){this.socket.emit("killUser",user)},ClientController.prototype.emitGoToCentral=function(user){this.socket.emit("goToCentral",user)},ClientController.prototype.emitDeathForFirstHere=function(user){this.socket.emit("deathForFirstHere",user),setTimeout(this.emitNextPlayer,200,user,this)},ClientController.prototype.emitNextPlayer=function(user,that){that?that.socket.emit("nextPlayerOk",user):this.socket.emit("nextPlayerOk",user)},ClientController.prototype.emitToken=function(color,coords){this.socket.emit("tokenPut",{color:color,coords:coords,userId:this.Helper.GetCurrentID()})},CoordsProvider.prototype.getCoordsController=function(u){var coords=[];return 2!=u.position.x&&2!=u.position.y?(coords.push({x:u.position.x,y:0},{x:u.position.x,y:1},{x:u.position.x,y:2},{x:u.position.x,y:3},{x:u.position.x,y:4}),coords.push({x:0,y:u.position.y},{x:1,y:u.position.y},{x:2,y:u.position.y},{x:3,y:u.position.y},{x:4,y:u.position.y})):2!=u.position.x&&2==u.position.y?coords.push({x:u.position.x,y:0},{x:u.position.x,y:1},{x:u.position.x,y:2},{x:u.position.x,y:3},{x:u.position.x,y:4}):2==u.position.x&&2!=u.position.y?coords.push({x:0,y:u.position.y},{x:1,y:u.position.y},{x:2,y:u.position.y},{x:3,y:u.position.y},{x:4,y:u.position.y}):coords.push({x:2,y:0},{x:2,y:1},{x:2,y:3},{x:2,y:4},{x:0,y:2},{x:1,y:2},{x:3,y:2},{x:4,y:2}),coords},CoordsProvider.prototype.getCoordsDeplacerRegarder=function(u){var coords=[];return 1*u.position.x>0&&coords.push({x:1*u.position.x-1,y:1*u.position.y}),1*u.position.x<4&&coords.push({x:1*u.position.x+1,y:1*u.position.y}),1*u.position.y>0&&coords.push({x:1*u.position.x,y:1*u.position.y-1}),1*u.position.y<4&&coords.push({x:1*u.position.x,y:1*u.position.y+1}),coords},CoordsProvider.prototype.getAllCoords=function(){var coords=[];return coords.push({x:0,y:0},{x:0,y:1},{x:0,y:2},{x:0,y:3},{x:0,y:4},{x:1,y:0},{x:1,y:1},{x:1,y:2},{x:1,y:3},{x:1,y:4},{x:2,y:0},{x:2,y:1},{x:2,y:3},{x:2,y:4},{x:3,y:0},{x:3,y:1},{x:3,y:2},{x:3,y:3},{x:3,y:4},{x:4,y:0},{x:4,y:1},{x:4,y:2},{x:4,y:3},{x:4,y:4}),coords},CoordsProvider.prototype.getAllControllerCoords=function(){var coords=[];return coords.push({x:0,y:0},{x:0,y:1},{x:0,y:3},{x:0,y:4},{x:1,y:0},{x:1,y:1},{x:1,y:3},{x:1,y:4},{x:3,y:0},{x:3,y:1},{x:3,y:3},{x:3,y:4},{x:4,y:0},{x:4,y:1},{x:4,y:3},{x:4,y:4}),coords},CoordsProvider.prototype.removeVisibleCoords=function(coords,helper){var newCoords=[];for(var i in coords)coords.hasOwnProperty(i)&&helper.GetTuile(coords[i].x,coords[i].y).children(".ng-hide").attr("id")&&helper.GetTuile(coords[i].x,coords[i].y).children(".ng-hide").attr("id").length>0&&newCoords.push(coords[i]);return newCoords},DOMView.prototype.showButton=function(){$(".btn").fadeIn(200,function(){$(".btn").css("display","block")})},DOMView.prototype.hideButton=function(){$(".btn").fadeOut(200)},DOMView.prototype.showButtonOk=function(){$(".btnOk").fadeIn("slow",function(){$(".btnOk").css("display","block")})},DOMView.prototype.hideButtonOk=function(){$(".btnOk").fadeOut("slow")},DOMView.prototype.disableActions=function(){$(".actions").append('<div class="loading"><p>En attente des autres joueurs...</p><img src="Images/loader.gif" alt="loader"></div>')},DOMView.prototype.hideActions=function(){$(".loading img").remove(),$(".btnOk").fadeOut("slow"),$(".loading p").html("C'est parti !")},DOMView.prototype.appendGardienWins=function(){$(".gameboard").append('<p class="tmpMessage">La partie est finie, les gardiens ont gagné !</p>')},DOMView.prototype.appendTmpMessage=function(message){$(".gameboard").append('<p class="tmpMessage tmp">'+message+"</p>"),setTimeout(function(){$(".tmpMessage.tmp").fadeOut("slow",function(){$(this).remove()})},3e3)},ErrorView.prototype.manageLoginError=function(){$("#newName").css({color:"red","box-shadow":"0 0 5px red","-webkit-box-shadow":"0 0 5px red","-moz-box-shadow":"0 0 5px red","-o-box-shadow":"0 0 5px red"}),$("#newName").attr("placeholder","Requis, lettre uniquement. ' et - autorisés.")},HelperController.prototype.GetCurrentID=function(){return $(".userID").val()},HelperController.prototype.SetCurrentID=function(id){$(".userID").attr("value",id)},HelperController.prototype.GetCharacterDiv=function(id){return $(null!==id&&id>=0?".character-"+id:".character-"+this.GetCurrentID())},HelperController.prototype.GetTuile=function(x,y){return $(null!==x&&x>=0&&null!==y&&y>=0?'.tuile[data-position="'+x+"-"+y+'"]':'.tuile[data-position="2-2"]')},HelperController.prototype.GetAction=function(action){return $(action?'.actions .action img[alt="'+action+'"]':".actions .action img")},MainView.prototype.setCaseEffect=function(ce){this.CaseEffect=ce},MainView.prototype.appendUserID=function(user){var that=this;that.Helper.SetCurrentID(user.id)},MainView.prototype.manageMultipleGames=function(available,users){var that=this;if(available)$(".hideCharacters").css("display","none");else{var message="Il y a actuellement déjà une partie qui se joue entre ",inAPartyUsers=[];for(var u in users)users.hasOwnProperty(u)&&users[u].inAParty&&inAPartyUsers.push(users[u]);for(var uu in inAPartyUsers)inAPartyUsers.hasOwnProperty(uu)&&inAPartyUsers[uu].id!=that.Helper.GetCurrentID()&&(message+=inAPartyUsers[uu].name,uu==inAPartyUsers.length-2?message+=" et ":uu<inAPartyUsers.length-2&&(message+=", "));message+=". Veillez patienter jusqu'à la fin de celle-ci.",$(".hideCharacters p").html(message),$(".hideCharacters").css("display","block")}},MainView.prototype.allowGame=function(){$(".hideCharacters").fadeOut("slow")},MainView.prototype.deleteCharacter=function(id,name,pseudo,color){$("ul.personnage li").each(function(){$(this).children("span").text()==name&&($(".characterTaken-"+id).remove(),$(this).append('<div class="characterTaken characterTaken-'+id+'" style="background:'+color+';opacity:0.6;"><p>'+pseudo+"</p></div>"))})},MainView.prototype.deleteUser=function(user){$(".characterTaken-"+user.id).remove(),this.Helper.GetCharacterDiv(user.id).addClass("dead"),this.DOMView.appendTmpMessage("Le joueur "+user.name+" est mort !")},MainView.prototype.refreshUsers=function(users){var that=this;for(var u in users)users.hasOwnProperty(u)&&""!==users[u].character&&that.usersLoop(users,u)},MainView.prototype.usersLoop=function(users,u){$("ul.personnage li").each(function(){var element=$(this);element.children("span").text()==users[u].character&&0===$(".characterTaken-"+users[u].id).length&&element.append('<div class="characterTaken characterTaken-'+users[u].id+'" style="background:'+users[u].color+';opacity:0.6;"><p>'+users[u].name+"</p></div>")})},MainView.prototype.redirectToGame=function(object,rtc){var that=this,userId=that.Helper.GetCurrentID();$(".readyToPlay").val(object.users[0].id),$(".readyToPlay").trigger("change"),setTimeout(function(){that.Helper.SetCurrentID(userId),that.showPlayers(object),that.showIdentity(object.users,userId),$(".coordsReady").val(1),$(".coordsReady").trigger("change");var video=$("video.webcam"),ids=[];for(var u in object.users)object.users.hasOwnProperty(u)&&($(".camContainer").append(video.clone().addClass("webcam-"+object.users[u].id)),ids.push("webcam-"+object.users[u].id));video.remove(),object.users[0].id!=that.Helper.GetCurrentID()&&($("#callButton").css("display","none"),$("#hangupButton").css("display","none")),rtc.initialize(ids,"webcam-"+that.Helper.GetCurrentID(),function(){})},500)},MainView.prototype.nextTurn=function(object){$(".tourRestant").html("Il reste "+object.nbTourRestant+" tours."),$(".actions .action").fadeIn("slow"),this.Helper.GetAction().fadeIn("slow"),$(".actions .action").children("p").remove(),$(".extendWidth").removeClass("extendWidth"),$(".action1-final > img, .action2-final > img").remove(),$(".actions .action").each(function(){$(this).removeClass("ok").removeClass("actionOk-1").removeClass("actionOk-2")})},MainView.prototype.showPlayers=function(object){var that=this,cpt=0;for(var u in object.users)if(object.users.hasOwnProperty(u)){$(".gameboard").append(object.users[u].id!=that.Helper.GetCurrentID().parseInt()?'<div class="character character-'+object.users[u].id+'" data-color="'+object.users[u].color+'" style="opacity: 0.8;background:'+object.users[u].color+';">'+object.users[u].name+"</div>":'<div class="myCharacter character character-'+object.users[u].id+'" data-color="'+object.users[u].color+'" style="opacity: 0.8;background:'+object.users[u].color+';">'+object.users[u].name+"</div>");var userDIV=that.Helper.GetCharacterDiv(object.users[u].id);cpt>=3?(userDIV.css("left",2*that.caseWidth+(cpt-3)*$(".character").outerWidth()+"px"),userDIV.css("top",2*that.caseHeight+$(".character").outerWidth()+"px")):(userDIV.css("left",2*that.caseWidth+cpt*$(".character").outerWidth()+"px"),userDIV.css("top",2*that.caseHeight+"px")),cpt++}},MainView.prototype.showIdentity=function(users,meID){for(var u in users)users.hasOwnProperty(u)&&users[u].id==meID&&($(".identity img").attr("src","Images/identities/"+users[u].identity+".gif").attr("title",users[u].identity),$(".pseudo p").html(users[u].name))},MainView.prototype.animateAction=function(element,toggle){{var isAction1=0===$(".action1-final > img").length;0===$(".action2-final > img").length}if(toggle){var img=element.children("img");if(isAction1)$(".action1-final").append(img.clone());else{if("noSecondAction"==this.Helper.GetCharacterDiv(this.Helper.GetCurrentID()).attr("handicap"))return!0;$(".action2-final").append(img.clone())}element.children("img").fadeOut("slow"),element.addClass("ok").addClass("actionOk-"+$(".action.ok").length)}else{var title=element.attr("title");isAction1,element.remove(),$('.action img[title="'+title+'"]').fadeIn("slow"),$('.action img[title="'+title+'"]').parent().removeClass("actionOk-"+$('.action img[title="'+title+'"]').parent().attr("class").split(" ").last().split("-").last()).removeClass("ok")}},MainView.prototype.appendTurnOf=function(u,users,actionNumber){var that=this;if($(".tourDe p").html("Tour de "+u.name),u.id==$(".userID").val()){$(".loading").remove(),$(".actions .action").fadeOut("slow");var actionDIV;if(1==actionNumber){if("noSee"===that.Helper.GetCharacterDiv(that.Helper.GetCurrentID()).attr("handicap")&&"Regarder"===u.action1)return!0;"deathAfterNextAction"===that.Helper.GetCharacterDiv(that.Helper.GetCurrentID()).attr("handicap")&&"Déplacer"!==u.action1&&this.CaseEffect.client.emitDeath(u),"deathAfterNextTour"===that.Helper.GetCharacterDiv(that.Helper.GetCurrentID()).attr("handicap")&&that.Helper.GetCharacterDiv(that.Helper.GetCurrentID()).attr("handicap","deathAfterThisTour"),actionDIV=that.Helper.GetAction(u.action1),actionDIV.parent().fadeIn(100).append("<p>"+actionDIV.parent().attr("data-first-sentence")+"</p>"),actionDIV.parent().parent().addClass("extendWidth")}else{if("noSee"===that.Helper.GetCharacterDiv(that.Helper.GetCurrentID()).attr("handicap")&&"Regarder"===u.action2)return!0;"deathAfterNextAction"===that.Helper.GetCharacterDiv(that.Helper.GetCurrentID()).attr("handicap")&&"Déplacer"!==u.action2&&this.CaseEffect.client.emitDeath(u),"deathAfterThisTour"===that.Helper.GetCharacterDiv(that.Helper.GetCurrentID()).attr("handicap")&&"Déplacer"!==u.action2&&this.CaseEffect.client.emitDeath(u),actionDIV=that.Helper.GetAction(u.action2),actionDIV.parent().fadeIn(100).append("<p>"+actionDIV.parent().attr("data-first-sentence")+"</p>"),actionDIV.parent().parent().addClass("extendWidth")}manageTurn(u,users,this.Helper,this.CoordsProvider)}},MainView.prototype.nextSentence=function(object){var that=this,actionDIV=that.Helper.GetAction(object.action);actionDIV.parent().children("p").html(actionDIV.parent().attr("data-second-sentence")),manageComplexAction(object,this.Helper,this.CoordsProvider)},MainView.prototype.deplacer=function(user){var that=this;this.Helper.GetCharacterDiv(user.id).animate({top:that.caseHeight*user.position.y+"px",left:that.caseWidth*user.position.x+"px"},500,function(){for(;that.someoneHere(user);)that.moveUser(user)});var tuile=this.Helper.GetTuile(user.position.x,user.position.y),imgs=tuile.children("img");imgs.first().removeClass("ng-hide"),imgs.first().fadeIn("slow"),imgs.last().fadeOut("slow"),this.Helper.GetCharacterDiv(user.id).removeAttr("handicap"),user.id==this.Helper.GetCurrentID()&&that.CaseEffect.manageCaseEffect(user,tuile.attr("data-action"))},MainView.prototype.pousser=function(userTarget,user){var that=this;that.Helper.GetCharacterDiv(userTarget.id).animate({top:that.caseHeight*userTarget.position.y+"px",left:that.caseWidth*userTarget.position.x+"px"},500);var tuile=that.Helper.GetTuile(userTarget.position.x,userTarget.position.y),imgs=tuile.children("img");imgs.first().removeClass("ng-hide"),imgs.first().fadeIn("slow"),imgs.last().fadeOut("slow"),this.Helper.GetCharacterDiv(userTarget.id).removeAttr("handicap"),user.id==this.Helper.GetCurrentID()&&that.CaseEffect.manageCaseEffect(userTarget,tuile.attr("data-action"),user)},MainView.prototype.regarder=function(userId,coords){if(!coords&&userId==this.Helper.GetCurrentID())return this.DOMView.appendTmpMessage("Choisissez la case que vous souhaitez regarder."),coords=this.CoordsProvider.getAllCoords(),appendSelect(coords,"regarderMaster",this.Helper),!0;var that=this,position={x:coords.split("-")[0].parseInt(),y:coords.split("-")[1].parseInt()};if(userId==that.Helper.GetCurrentID()){var imgs=that.Helper.GetTuile(position.x,position.y).children("img");imgs.first().hasClass("ng-hide")&&(imgs.first().removeClass("ng-hide"),imgs.first().fadeIn("slow"),imgs.last().fadeOut("slow"),setTimeout(function(){imgs.first().addClass("ng-hide"),imgs.first().fadeOut("slow"),imgs.last().fadeIn("slow")},3e3))}},MainView.prototype.controller=function(users,coords,sens){var that=this;if(!coords&&!sens&&users.id==that.Helper.GetCurrentID())return this.DOMView.appendTmpMessage("Choisissez la rangée que vous souhaitez contrôller."),coords=this.CoordsProvider.getAllControllerCoords(),appendSelect(coords,"controllerMaster",this.Helper),!0;"left"==sens||"right"==sens?$(".tuile").each(function(){var x=$(this).attr("data-position").split("-")[0].parseInt(),y=$(this).attr("data-position").split("-")[1].parseInt();y==coords.split("-")[1].parseInt()&&(0===x&&"left"===sens?x=4:4===x&&"right"===sens?x=0:"left"===sens?x-=1:x+=1,$(this).attr("data-position",x+"-"+y),$(this).addClass("moved"))}):("top"===sens||"bottom"===sens)&&$(".tuile").each(function(){var x=$(this).attr("data-position").split("-")[0].parseInt(),y=$(this).attr("data-position").split("-")[1].parseInt();x==coords.split("-")[0].parseInt()&&(0===y&&"top"===sens?y=4:4===y&&"bottom"===sens?y=0:"top"===sens?y-=1:y+=1,$(this).attr("data-position",x+"-"+y),$(this).addClass("moved"))}),$(".moved").each(function(){$(this).animate({top:$(this).attr("data-position").split("-")[1].parseInt()*that.caseHeight+"px",left:$(this).attr("data-position").split("-")[0].parseInt()*that.caseWidth+"px"},500)});for(var u in users)users.hasOwnProperty(u)&&that.Helper.GetCharacterDiv(users[u].id).animate({top:1*users[u].position.y*that.caseHeight,left:1*users[u].position.x*that.caseWidth},500);setTimeout(function(){for(var u in users)if(users.hasOwnProperty(u))for(;that.someoneHere(users[u]);)that.moveUser(users[u])},500),setTimeout(function(){$(".moved").removeClass("moved")},200)},MainView.prototype.exchangeTuileAndUsers=function(users,user,lastCoords){var futurTuile=this.Helper.GetTuile(user.position.x,user.position.y),lastTuile=this.Helper.GetTuile(lastCoords.split("-")[0],lastCoords.split("-")[1]),that=this;lastTuile.animate({top:futurTuile.attr("data-position").split("-")[1].parseInt()*that.caseHeight+"px",left:futurTuile.attr("data-position").split("-")[0].parseInt()*that.caseWidth+"px"},500),futurTuile.animate({top:lastTuile.attr("data-position").split("-")[1].parseInt()*that.caseHeight+"px",left:lastTuile.attr("data-position").split("-")[0].parseInt()*that.caseWidth+"px"},500);for(var u in users)users.hasOwnProperty(u)&&that.Helper.GetCharacterDiv(users[u].id).animate({top:1*users[u].position.y*that.caseHeight+"px",left:1*users[u].position.x*that.caseWidth+"px"},500);lastTuile.attr("data-position",futurTuile.attr("data-position")),futurTuile.attr("data-position",lastCoords),setTimeout(function(){for(var u in users)if(users.hasOwnProperty(u))for(;that.someoneHere(users[u]);)that.moveUser(users[u])},500)},MainView.prototype.exchangeAndApplyTuileAndUsers=function(users,user,lastCoords,newCoords){var futurTuile=this.Helper.GetTuile(newCoords.split("-")[0],newCoords.split("-")[1]),lastTuile=this.Helper.GetTuile(lastCoords.split("-")[0],lastCoords.split("-")[1]),that=this;lastTuile.animate({top:futurTuile.attr("data-position").split("-")[1].parseInt()*that.caseHeight+"px",left:futurTuile.attr("data-position").split("-")[0].parseInt()*that.caseWidth+"px"},500),futurTuile.animate({top:lastTuile.attr("data-position").split("-")[1].parseInt()*that.caseHeight+"px",left:lastTuile.attr("data-position").split("-")[0].parseInt()*that.caseWidth+"px"},500),lastTuile.attr("data-position",futurTuile.attr("data-position")),futurTuile.attr("data-position",lastCoords);var imgs=futurTuile.children("img");imgs.first().removeClass("ng-hide"),imgs.first().fadeIn("slow"),imgs.last().fadeOut("slow"),user.id==this.Helper.GetCurrentID()&&that.CaseEffect.manageCaseEffect(user,futurTuile.attr("data-action"))},MainView.prototype.exchangeTuile=function(u){return u.id==this.Helper.GetCurrentID()?(this.DOMView.appendTmpMessage("Choisissez la case où vous voulez vous rendre."),coords=this.CoordsProvider.getAllCoords(),coords=this.CoordsProvider.removeVisibleCoords(coords,this.Helper),appendSelect(coords,"teleporter",this.Helper),0===$(".selectMe").length&&this.CaseEffect.client.socket.emit("noPossibilities",{user:u}),!0):void 0},MainView.prototype.exchangeAndApplyTuile=function(id){return id==this.Helper.GetCurrentID()?(this.DOMView.appendTmpMessage("Choisissez la case à échanger."),coords=this.CoordsProvider.getAllCoords(),coords=this.CoordsProvider.removeVisibleCoords(coords,this.Helper),appendSelect(coords,"exchange",this.Helper),!0):void 0},MainView.prototype.someoneHere=function(user){var anybody=!1,$user=this.Helper.GetCharacterDiv(user.id);return $(".character").each(function(){$(this).css("top")!=$user.css("top")||$(this).css("left")!=$user.css("left")||$(this).hasClass("character-"+user.id)||(anybody=!0)}),anybody},MainView.prototype.moveUser=function(user){var userDIV=this.Helper.GetCharacterDiv(user.id);userDIV.css("left",userDIV.css("left").substr(0,userDIV.css("left").length-2).parseInt()+50+"px")},MainView.prototype.appendSelectToken=function(){var color=this.Helper.GetCharacterDiv().data("color"),coords=this.CoordsProvider.removeVisibleCoords(this.CoordsProvider.getAllCoords(),this.Helper),that=this;for(var c in coords)if(coords.hasOwnProperty(c)){var tuile=that.Helper.GetTuile(coords[c].x,coords[c].y);tuile.append('<div class="selectMeToken" style="background:'+color+';"></div>')}},MainView.prototype.appendTokenPut=function(object){var tuile=this.Helper.GetTuile(object.coords.split("-").first(),object.coords.split("-").last());tuile.css("background-color",object.color),tuile.data("tokenuser",object.userId)},RTCController.prototype.initialize=function(ids,localID,callback){this.callBtn=document.getElementById("callButton"),this.hangupBtn=document.getElementById("hangupButton");var that=this;that.udp.initialize(),that.localVideo=$("."+localID);for(var id in ids)ids.hasOwnProperty(id)&&ids[id]!=localID&&that.videos.push($("."+ids[id]));that.udp.RtcPeer.onaddstream=function(e){that.videos[that.cpt][0].src=window.URL.createObjectURL(e.stream),that.cpt++},this.callBtn.onclick=function(){navigator.getUserMedia(that.constraints,function(stream){that.udp.RtcPeer.addStream(stream),that.udp.connect(callback)},that.udp.errorHandler)},this.hangupBtn.onclick=function(){for(var id in ids)ids.hasOwnProperty(id)&&ids[id]!=localID&&($("."+ids[id])[0].src=null);that.localVideo[0].src=null}},RTCController.prototype.trace=function(text){console.log((performance.now()/1e3).toFixed(3)+": "+text)},RTCController.prototype.handleError=function(){},RtcPeerConnection.prototype.initialize=function(){if(navigator.mozGetUserMedia||navigator.webkitGetUserMedia){this.dbRef=new Firebase("https://room25.firebaseIO.com/"),this.roomRef=this.dbRef.child("rooms"),this.PeerConnection=window.mozRTCPeerConnection||window.webkitRTCPeerConnection,this.IceCandidate=window.mozRTCIceCandidate||window.RTCIceCandidate,this.SessionDescription=window.mozRTCSessionDescription||window.RTCSessionDescription,navigator.getUserMedia=navigator.getUserMedia||navigator.mozGetUserMedia||navigator.webkitGetUserMedia,this.ROOM=location.hash.substr(1),this.typeRequest="answerer";var otherType="offerer";"/game"==this.ROOM?(this.ROOM=42,this.typeRequest="offerer",otherType="answerer"):this.ROOM=42,this.RtcPeer=new this.PeerConnection(this.configurations,this.rtcOptions);var that=this;this.RtcPeer.onicecandidate=function(e){e.candidate&&(that.recv(that.ROOM,"candidate:"+otherType,function(candidate){that.RtcPeer.addIceCandidate(new that.IceCandidate(JSON.parse(candidate)))
}),that.send(that.ROOM,"candidate:"+that.typeRequest,JSON.stringify(e.candidate)))}}else console.log("Browser does not appear to be WebRTC-capable")},RtcPeerConnection.prototype.connect=function(callback){var that=this;"offerer"===this.typeRequest?this.RtcPeer.createOffer(function(offer){that.RtcPeer.setLocalDescription(offer),that.send(that.ROOM,"offer",JSON.stringify(offer)),that.recv(that.ROOM,"answer",function(answer){that.RtcPeer.setRemoteDescription(new that.SessionDescription(JSON.parse(answer)))}),callback()},that.errorHandler,that.SDPConstraints):that.recv(that.ROOM,"offer",function(offer){that.RtcPeer.setRemoteDescription(new that.SessionDescription(JSON.parse(offer))),that.RtcPeer.createAnswer(function(answer){that.RtcPeer.setLocalDescription(answer),that.send(that.ROOM,"answer",JSON.stringify(answer))},that.errorHandler,that.SDPConstraints)})},RtcPeerConnection.prototype.id=function(){return(1e4*Math.random()+1e4|0).toString()},RtcPeerConnection.prototype.send=function(room,key,data){this.roomRef.child(room).child(key).set(data)},RtcPeerConnection.prototype.recv=function(room,type,cb){this.roomRef.child(room).child(type).on("value",function(snapshot){var data=snapshot.val();data&&cb(data)})},RtcPeerConnection.prototype.errorHandler=function(err){console.error(err)};var LastCoords=[],OtherCoords=[];$(document).ready(function(){var Udp=new RtcPeerConnection,Rtc=new RTCController(Udp),Helper=new HelperController,Coords=new CoordsProvider,ErrView=new ErrorView(Helper),DOM=new DOMView(Helper),View=new MainView(Helper,DOM,Coords),Client=new ClientController(View,DOM,Helper,Rtc),CaseEffect=new CaseEffectController(Client);View.setCaseEffect(CaseEffect),Client.initialize(),$("body").on("click",".toggle",function(){$(this).parent().outerWidth()>1?($(this).parent().animate({width:"0px"},500),$(this).parent().children("*").addClass("hiddencontent"),$(".toggle").removeClass("hiddencontent")):($(this).parent().animate({width:"200px"},500),$(this).parent().children("*").removeClass("hiddencontent"))}),$("body").on("click","#getMyName",function(){var patt=/[a-zA-Z\-\']+/;return patt.test($("#newName").val())?(Client.newUser($("#newName").val()),void $("#popin-grayback").fadeOut("slow")):(ErrView.manageLoginError(),!1)}),$("body").on("mouseover",".personnage li",function(){$this=$(this),$(".personnage li").each(function(){$this[0]!=$(this)[0]&&$(this).stop().animate({opacity:"0.6"},200)})}).on("mouseleave",".personnage li",function(){$(".personnage li").stop().animate({opacity:"1"},200)}),$("body").on("click","ul.personnage li, .characterTaken",function(e){e.stopPropagation(),$(this).hasClass("characterTaken")||($(".characterTaken-"+$(".userID").val()).remove(),Client.characterChoosen($(this).children("span").text(),$(".userID").val(),$(this).data("color")))}),$("body").on("click",".btn",function(){Client.play()}),$("body").on("click",".action",function(){($(".action.ok").length<2||$(this).hasClass("ok"))&&(View.animateAction($(this),!$(this).hasClass("ok")),$(".action.ok").length>0?DOM.showButtonOk():DOM.hideButtonOk())}),$("body").on("click",".action1-final > img, .action2-final > img",function(){View.animateAction($(this),!1),$(".action.ok").length>0?DOM.showButtonOk():DOM.hideButtonOk()}),$("body").on("click",".btnOk",function(){DOM.disableActions();var action2="";$(".actionOk-2").length>0&&(action2=$(".actionOk-2").children("img").attr("alt")),Client.validateAction($(".userID").val(),$(".actionOk-1").children("img").attr("alt"),action2)}),$("body").on("click",".tuile .selectMe, .character .characterSelectMe",function(){Client.emitAction($(this))}),$("body").on("click",".tuile .selectMeToken",function(){var color=$(this).css("background-color"),coords=$(this).parent().data("data-position");Client.emitToken(color,coords),$(".selectMeToken").remove()}),$("body").on("click","span.direction",function(){var element=$(this),action="Contrôller",sens=element.removeClass("direction").attr("class"),position=element.parent().attr("data-position");return element.addClass("direction"),Client.emitComplexAction({element:element,action:action,sens:sens,position:position}),!1}),$("body").on("click",".putAToken",function(){View.appendSelectToken()})});var Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(input){var chr1,chr2,chr3,enc1,enc2,enc3,enc4,output="",i=0;for(input=Base64._utf8_encode(input);i<input.length;)chr1=input.charCodeAt(i++),chr2=input.charCodeAt(i++),chr3=input.charCodeAt(i++),enc1=chr1>>2,enc2=(3&chr1)<<4|chr2>>4,enc3=(15&chr2)<<2|chr3>>6,enc4=63&chr3,isNaN(chr2)?enc3=enc4=64:isNaN(chr3)&&(enc4=64),output=output+this._keyStr.charAt(enc1)+this._keyStr.charAt(enc2)+this._keyStr.charAt(enc3)+this._keyStr.charAt(enc4);return output},decode:function(input){var chr1,chr2,chr3,enc1,enc2,enc3,enc4,output="",i=0;for(input=input.replace(/[^A-Za-z0-9\+\/\=]/g,"");i<input.length;)enc1=this._keyStr.indexOf(input.charAt(i++)),enc2=this._keyStr.indexOf(input.charAt(i++)),enc3=this._keyStr.indexOf(input.charAt(i++)),enc4=this._keyStr.indexOf(input.charAt(i++)),chr1=enc1<<2|enc2>>4,chr2=(15&enc2)<<4|enc3>>2,chr3=(3&enc3)<<6|enc4,output+=String.fromCharCode(chr1),64!=enc3&&(output+=String.fromCharCode(chr2)),64!=enc4&&(output+=String.fromCharCode(chr3));return output=Base64._utf8_decode(output)},_utf8_encode:function(string){string=string.replace(/\r\n/g,"\n");for(var utftext="",n=0;n<string.length;n++){var c=string.charCodeAt(n);128>c?utftext+=String.fromCharCode(c):c>127&&2048>c?(utftext+=String.fromCharCode(c>>6|192),utftext+=String.fromCharCode(63&c|128)):(utftext+=String.fromCharCode(c>>12|224),utftext+=String.fromCharCode(c>>6&63|128),utftext+=String.fromCharCode(63&c|128))}return utftext},_utf8_decode:function(utftext){for(var string="",i=0,c=0,c2=0;i<utftext.length;)c=utftext.charCodeAt(i),128>c?(string+=String.fromCharCode(c),i++):c>191&&224>c?(c2=utftext.charCodeAt(i+1),string+=String.fromCharCode((31&c)<<6|63&c2),i+=2):(c2=utftext.charCodeAt(i+1),c3=utftext.charCodeAt(i+2),string+=String.fromCharCode((15&c)<<12|(63&c2)<<6|63&c3),i+=3);return string}};!function(){"use strict";angular.module("Room25App").controller("CharacterCtrl",function($scope,$http,$location){$scope.characters=[],$scope.readyToPlay=-1,$http({method:"GET",url:"Json/characters.json"}).success(function(data){$scope.characters=data}).error(function(data,status,headers,config){console.log(data),console.log(status),console.log(headers),console.log(config)}),$scope.$watch("readyToPlay",function(newValue){newValue>=0&&(newValue==document.getElementById("userID").value?($scope.readyToPlay=newValue,$location.path("/game")):($scope.readyToPlay=newValue,$location.path("/game/join")))},!0)})}(),function(){"use strict";angular.module("Room25App").controller("GameCtrl",function($scope,$http){function getTuiles(data,last){var array=[];for(var t in data)data.hasOwnProperty(t)&&data[t].last===last&&array.push(data[t]);return array}$scope.tuiles=[],$scope.actions=[],$scope.coordsReady=-1,$http({method:"GET",url:"Json/actions.json"}).success(function(data){$scope.actions=data}).error(function(data,status,headers,config){console.log(data),console.log(status),console.log(headers),console.log(config)}),$scope.$watch("coordsReady",function(newValue){-1!==newValue&&$http({method:"GET",url:"Json/tuiles.json"}).success(function(data){$scope.tuiles=$scope.mixTuiles(data,LastCoords,OtherCoords)}).error(function(data,status,headers,config){console.log(data),console.log(status),console.log(headers),console.log(config)})},!0),$scope.mixTuiles=function(data,last,other){var realTuile=getTuiles(data,!0);for(var t in realTuile)realTuile.hasOwnProperty(t)&&(realTuile[t].position.x=last[t].x,realTuile[t].position.y=last[t].y);var otherTuile=getTuiles(data,!1);for(var tu in otherTuile)otherTuile.hasOwnProperty(tu)&&(otherTuile[tu].position.x=other[tu].x,otherTuile[tu].position.y=other[tu].y);return realTuile.concat(otherTuile).concat(getTuiles(data,null))}})}(),function(){"use strict";var app=angular.module("Room25App",["ngRoute"]);app.config(function($routeProvider){$routeProvider.when("/",{templateUrl:"Views/home.html"}).when("/game",{templateUrl:"Views/game.html",reloadOnSearch:!1}).when("/game/join",{templateUrl:"Views/game.html",reloadOnSearch:!1}).otherwise({redirectTo:"/"})}),app.controller("MainCtrl",function(){})}();var coordsManager=function(){this.getForVIPCases=function(){return[{x:0,y:0},{x:1,y:0},{x:0,y:1},{x:4,y:0},{x:3,y:0},{x:4,y:1},{x:4,y:4},{x:4,y:3},{x:3,y:4},{x:1,y:4},{x:0,y:4},{x:0,y:3}]},this.getForOtherCases=function(){return[{x:2,y:0},{x:1,y:1},{x:2,y:1},{x:3,y:1},{x:0,y:2},{x:1,y:2},{x:3,y:2},{x:4,y:2},{x:1,y:3},{x:2,y:3},{x:3,y:3},{x:2,y:4}]},this.shufflePositions=function(coords){for(var j=0,valI="",valJ=valI,l=coords.length-1;l>-1;)j=Math.floor(Math.random()*l),valI=coords[l],valJ=coords[j],coords[l]=valJ,coords[j]=valI,l-=1;return coords},this.findInArray=function(array,position){var positionTmp=null;for(var a in array)if(array.hasOwnProperty(a)&&array[a].x==position.x&&array[a].y==position.y){positionTmp=a;break}return positionTmp},this.manageCoords=function(){var coordsPossible=this.getForVIPCases();coordsPossible=this.shufflePositions(coordsPossible);var lastCardsCoords=[];lastCardsCoords.push(coordsPossible[0]),lastCardsCoords.push(coordsPossible[1]);var otherCoords=this.getForOtherCases();return otherCoords=otherCoords.concat(coordsPossible),otherCoords=this.shufflePositions(otherCoords),otherCoords=this.deleteLastCardsCoords(otherCoords,lastCardsCoords),[lastCardsCoords,otherCoords]},this.deleteLastCardsCoords=function(arrayFrom,arrayTo){var arrayReturn=[],that=this;for(var t in arrayFrom)arrayFrom.hasOwnProperty(t)&&(that.findInArray(arrayTo,arrayFrom[t])||arrayReturn.push(arrayFrom[t]));return arrayReturn},this.getNewUserPositionAfterController=function(user,sens){return"top"==sens?user.position.y=user.position.y>0?1*user.position.y-1:4:"bottom"==sens?user.position.y=user.position.y<4?1*user.position.y+1:0:"left"==sens?user.position.x=user.position.x>0?1*user.position.x-1:4:"right"==sens&&(user.position.x=user.position.x<4?1*user.position.x+1:0),user}};exports.coordsManager=coordsManager;var debugManager=function(){this.debugArray=function(array){for(var a in array)console.log(a+" -> "+array[a])},this.debugObject=function(object){var props="";for(var prop in object)props+=prop+" => "+object[prop]+"\n";console.log(props)},this.debugArrayOfObject=function(array){var that=this;for(var a in array)that.debugObject(array[a])},this.messageForUser=function(user,message){console.log("L'utilisateur "+user.id+" : "+user.name+" "+message)}};exports.debugManager=debugManager;var gameManager=function(){this.everyoneIsOk=function(users){var ready=!0;for(var a in users)if(users.hasOwnProperty(a)&&!users[a].ready){ready=!1;break}return ready},this.everyoneIsNok=function(users){var notReady=!0;for(var a in users)if(users.hasOwnProperty(a)&&users[a].ready){notReady=!1;break}return notReady},this.gardienWins=function(users){var bool=0;for(var u in users)users.hasOwnProperty(u)&&"prisonnier"===users[u].identity&&bool++;return 2>=bool},this.moreThanFourPlayers=function(users){var cpt=0;for(var a in users)users.hasOwnProperty(a)&&""!==users[a].character&&cpt++;return cpt>=4},this.manageIdentity=function(users,shuffleFunction){var identities;identities=4==users.length?["prisonnier","prisonnier","prisonnier","prisonnier","gardien"]:["prisonnier","prisonnier","prisonnier","prisonnier","gardien","gardien"],identities=shuffleFunction(identities);for(var u in users)users.hasOwnProperty(u)&&(users[u].identity=identities[u]);return users}};exports.gameManager=gameManager;var userManager=function(){this.getById=function(users,id){var u=null;for(var a in users)if(users.hasOwnProperty(a)&&users[a].id==id){u=a;break}return u},this.getByOrder=function(users,order){var u=null;for(var a in users)if(users.hasOwnProperty(a)&&users[a].order==order){u=users[a];break}return u},this.getInTheSameRow=function(users,coords,sens){var r=[];if("top"==sens||"bottom"==sens)for(var u in users)users.hasOwnProperty(u)&&users[u].position.x==coords.split("-")[0]&&r.push(u);else if("left"==sens||"right"==sens)for(var u2 in users)users.hasOwnProperty(u2)&&users[u2].position.y==coords.split("-")[1]&&r.push(u2);return r},this.getInTheSameCase=function(users,user){var r=[];for(var u in users)users.hasOwnProperty(u)&&users[u].position.x==user.position.x&&users[u].position.y==user.position.y&&users[u].id!=user.id&&r.push(users[u]);return r},this.processPlayerOrder=function(users,shuffleFunction){users=shuffleFunction(users);for(var i in users)users.hasOwnProperty(i)&&(users[i].order=i,users[i].inAParty=!0);return users},this.killLastUsers=function(users){var that=this;for(var i in users)users.hasOwnProperty(i)&&users[i].inAParty&&users.splice(that.getById(users,users[i].id),1);return users}};exports.userManager=userManager;